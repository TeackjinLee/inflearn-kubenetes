# 컨피그맵(ConfigMap), 시크릿(Secret)을 활용해 환경변수 분리하기

1. **ConfigMap 매니페스트 파일 생성하기**
    
    **spring-config.yaml**
    
    ```bash
    apiVersion: v1
    kind: ConfigMap
    
    # ConfigMap 기본 정보
    metadata:
      name: spring-config # ConfigMap 이름
    
    # Key, Value 형식으로 설정값 저장
    data:
      db-host: mysql-service
      db-port: "3306"
      db-name: kub-practice
    ```
    
    **spring-deployment.yaml**
    
    ```bash
    apiVersion: apps/v1
    kind: Deployment
    
    # Deployment 기본 정보
    metadata:
      name: spring-deployment # Deployment 이름
    
    # Deployment 세부 정보
    spec:
      replicas: 3 # 생성할 파드의 복제본 개수
      selector:
        matchLabels:
          app: backend-app # 아래에서 정의한 Pod 중 'app: backend-app'이라는 값을 가진 파드를 선택
    
      # 배포할 Pod 정의
      template:
        metadata:
          labels: # 레이블 (= 카테고리)
            app: backend-app
        spec:
          containers:
            - name: spring-container # 컨테이너 이름
              image: spring-server # 컨테이너를 생성할 때 사용할 이미지
              imagePullPolicy: IfNotPresent # 로컬에서 이미지를 먼저 가져온다. 없으면 레지스트리에서 가져온다.
              ports:
                - containerPort: 8080  # 컨테이너에서 사용하는 포트를 명시적으로 표현
              env:
                **- name: DB_HOST
                  valueFrom:
                    configMapKeyRef:
                      name: spring-config
                      key: db-host
                - name: DB_PORT
                  valueFrom:
                    configMapKeyRef:
                      name: spring-config
                      key: db-port
                - name: DB_NAME
                  valueFrom:
                    configMapKeyRef:
                      name: spring-config
                      key: db-name**
                - name: DB_USERNAME
                  value: root
                - name: DB_PASSWORD
                  value: password123
    ```
    

1. **Secret 매니페스트 파일 만들기**
    
    **spring-secret.yaml**
    
    ```bash
    apiVersion: v1
    kind: Secret
    
    # Secret 기본 정보
    metadata:
      name: spring-secret # Secret 이름
    
    # Key, Value 형식으로 값 저장
    stringData:
      db-username: root
      db-password: password123
    ```
    
    **spring-deployment.yaml**
    
    ```bash
    apiVersion: apps/v1
    kind: Deployment
    
    # Deployment 기본 정보
    metadata:
      name: spring-deployment # Deployment 이름
    
    # Deployment 세부 정보
    spec:
      replicas: 3 # 생성할 파드의 복제본 개수
      selector:
        matchLabels:
          app: backend-app # 아래에서 정의한 Pod 중 'app: backend-app'이라는 값을 가진 파드를 선택
    
      # 배포할 Pod 정의
      template:
        metadata:
          labels: # 레이블 (= 카테고리)
            app: backend-app
        spec:
          containers:
            - name: spring-container # 컨테이너 이름
              image: spring-server # 컨테이너를 생성할 때 사용할 이미지
              imagePullPolicy: IfNotPresent # 로컬에서 이미지를 먼저 가져온다. 없으면 레지스트리에서 가져온다.
              ports:
                - containerPort: 8080  # 컨테이너에서 사용하는 포트를 명시적으로 표현
              env:
                - name: DB_HOST
                  valueFrom:
                    configMapKeyRef:
                      name: spring-config
                      key: db-host
                - name: DB_PORT
                  valueFrom:
                    configMapKeyRef:
                      name: spring-config
                      key: db-port
                - name: DB_NAME
                  valueFrom:
                    configMapKeyRef:
                      name: spring-config
                      key: db-name
                **- name: DB_USERNAME
                  valueFrom:
                    secretKeyRef:
                      name: spring-secret
                      key: db-username
                - name: DB_PASSWORD
                  valueFrom:
                    secretKeyRef:
                      name: spring-secret
                      key: db-password**
    ```
    
2. **매니페스트 파일 반영하기**
    
    ```bash
    $ kubectl apply -f spring-secret.yaml
    $ kubectl apply -f spring-config.yaml
    $ kubectl apply -f spring-deployment.yaml
    $ kubectl rollout restart deployment spring-deployment
    ```
    

1. **잘 반영됐는 지 확인하기**

   <img width="337" height="121" alt="image" src="https://github.com/user-attachments/assets/eff316e1-0de7-4c9b-bf0a-67bb1b223a83" />
