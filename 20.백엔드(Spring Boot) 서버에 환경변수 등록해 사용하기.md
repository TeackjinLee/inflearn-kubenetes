# [예제] 백엔드(Spring Boot) 서버에 환경변수 등록해 사용하기

### ✅ 백엔드(Spring Boot) 서버에 환경변수 등록해 사용하기

1. **Spring Boot 프로젝트 셋팅**
    
    [start.spring.io](https://start.spring.io/)
    
<img width="2048" height="1054" alt="image" src="https://github.com/user-attachments/assets/114230df-04ee-470d-9f48-6142b34fcf08" />
    

1. **간단한 코드 작성**
    
    **AppController**
    
    ```java
    @RestController
    public class AppController {
      @Value("${MY_ACCOUNT:default}")
      private String myAccount;
      
      @Value("${MY_PASSWORD:default}")
      private String myPassword;
    
      @GetMapping("/")
      public String home() {
        return "myAccount: " + myAccount + ", myPassword: " + myPassword;
      }
    }
    ```
    
2. **프로젝트 실행시켜보기**
    
<img width="678" height="302" alt="image" src="https://github.com/user-attachments/assets/f91a16b6-02ed-48d2-933c-10274cd1c292" />
    
3. **Dockerfile 작성하기**
    
    **Dockerfile**
    
    ```docker
    FROM openjdk:17-jdk
    
    COPY build/libs/*SNAPSHOT.jar app.jar
    
    ENTRYPOINT ["java", "-jar", "/app.jar"]
    ```
    
4. **Spring Boot 프로젝트 빌드하기**
    
    ```bash
    $ ./gradlew clean build
    ```
    
5. **Dockerfile을 바탕으로 이미지 빌드하기**
    
    ```bash
    $ docker build -t spring-server .
    ```
    
6. **매니페스트 파일 작성하기**
    
    **spring-deployment.yaml**
    
    ```bash
    apiVersion: apps/v1
    kind: Deployment
    
    # Deployment 기본 정보
    metadata:
      name: spring-deployment # Deployment 이름
    
    # Deployment 세부 정보
    spec:
      replicas: 3 # 생성할 파드의 복제본 개수
      selector:
        matchLabels:
          app: backend-app # 아래에서 정의한 Pod 중 'app: backend-app'이라는 값을 가진 파드를 선택
    
      # 배포할 Pod 정의
      template:
        metadata:
          labels: # 레이블 (= 카테고리)
            app: backend-app
        spec:
          containers:
            - name: spring-container # 컨테이너 이름
              image: spring-server # 컨테이너를 생성할 때 사용할 이미지
              imagePullPolicy: IfNotPresent # 로컬에서 이미지를 먼저 가져온다. 없으면 레지스트리에서 가져온다.
              ports:
                - containerPort: 8080  # 컨테이너에서 사용하는 포트를 명시적으로 표현
              **env:** # 환경변수 등록
                **- name: MY_ACCOUNT
                  value: jaeseong
                - name: MY_PASSWORD
                  value: pwd1234**
    ```
    
    **spring-service.yaml**
    
    ```bash
    apiVersion: v1
    kind: Service
    
    # Service 기본 정보
    metadata:
      name: spring-service
      
    # Service 세부 정보
    spec:
      type: NodePort # Service의 종류
      selector:
        app: backend-app # 실행되고 있는 파드 중 'app: backend-app'이라는 값을 가진 파드와 서비스를 연결
      ports:
        - protocol: TCP # 서비스에 접속하기 위한 프로토콜
          port: 8080 # 쿠버네티스 내부에서 Service에 접속하기 위한 포트 번호 (Service
          targetPort: 8080 # 매핑하기 위한 파드의 포트 번호
          nodePort: 30000 # 외부에서 사용자들이 접근하게 될 포트 번호
    ```
    
7. **매니페스트 기반으로 실행시키기**
    
    ```bash
    $ kubectl apply -f spring-deployment.yaml
    $ kubectl apply -f spring-service.yaml
    ```
    
8. **환경변수가 잘 적용됐는 지 확인해보기**
    
<img width="824" height="234" alt="image" src="https://github.com/user-attachments/assets/b6d2aa86-4431-46e0-a852-dacbb057daaf" />
    
9. **파드 내부로 접속해서 확인해보기**
    
    ```bash
    $ kubectl get pods # 파드명 확인하기
    $ kubectl exec -it [파드명] -- bash # 파드 내부로 접속하기
    
    $ env # 환경변수 조회
    ```
    
<img width="1820" height="494" alt="image" src="https://github.com/user-attachments/assets/77668a41-8b13-4e73-9acc-fa5f4bcbde07" />
    
<img width="1848" height="1078" alt="image" src="https://github.com/user-attachments/assets/15537e17-dadb-4999-b3ef-547384c3023d" />
