# [예제] 백엔드(Spring Boot) 서버와 MySQL 연동하기

### ✅ 백엔드(Spring Boot) 서버와 MySQL 연동하기

1. **Spring Boot 프로젝트 셋팅**
    
    [start.spring.io](https://start.spring.io/)
    
<img width="2048" height="1360" alt="image" src="https://github.com/user-attachments/assets/2f4528a3-70d6-4860-9a6c-4d07213d404a" />
    
    - Java 17 버전을 선택하자. 아래 과정을 Java 17 버전을 기준으로 진행할 예정이다.
    - Dependencies는 `Spring Boot DevTools`, `Spring Web`, `Spring Data JPA`, `MySQL Driver`를 선택해라.
    
2. **간단한 코드 작성**
    
    **AppController**
    
    ```java
    @RestController
    public class AppController {
      @GetMapping("/")
      public String home() {
        return "Hello, World!";
      }
    }
    ```
    
3. **application.yml에 DB 연결을 위한 정보 작성하기**
    
    **application.yml**
    
    ```bash
    spring:
      datasource:
        url: jdbc:mysql://${DB_HOST}:${DB_PORT}/${DB_NAME}
        username: ${DB_USERNAME}
        password: ${DB_PASSWORD}
        driver-class-name: com.mysql.cj.jdbc.Driver
    ```
    

1. **불필요한 테스트 코드 삭제**
    
<img width="748" height="290" alt="image" src="https://github.com/user-attachments/assets/b7514f23-05c7-4bfa-83e5-670c6dfba8a8" />
    
2. **Dockerfile 작성하기**
    
    **Dockerfile**
    
    ```bash
    FROM openjdk:17-jdk
    
    COPY build/libs/*SNAPSHOT.jar /app.jar
    
    ENTRYPOINT ["java", "-jar", "/app.jar"]
    ```
    
3. **Spring Boot 프로젝트 빌드하기**
    
    ```bash
    $ ./gradlew clean build
    ```
    
4. **이미지 빌드하기**
    
    ```bash
    $ docker build -t spring-server .
    ```
    
5. **스프링 서버 띄우기 위한 매니페스트 파일 작성하기**
    
    **spring-deployment.yaml**
    
    ```bash
    apiVersion: apps/v1
    kind: Deployment
    
    # Deployment 기본 정보
    metadata:
      name: spring-deployment # Deployment 이름
    
    # Deployment 세부 정보
    spec:
      replicas: 3 # 생성할 파드의 복제본 개수
      selector:
        matchLabels:
          app: backend-app # 아래에서 정의한 Pod 중 'app: backend-app'이라는 값을 가진 파드를 선택
    
      # 배포할 Pod 정의
      template:
        metadata:
          labels: # 레이블 (= 카테고리)
            app: backend-app
        spec:
          containers:
            - name: spring-container # 컨테이너 이름
              image: spring-server # 컨테이너를 생성할 때 사용할 이미지
              imagePullPolicy: IfNotPresent # 로컬에서 이미지를 먼저 가져온다. 없으면 레지스트리에서 가져온다.
              ports:
                - containerPort: 8080  # 컨테이너에서 사용하는 포트를 명시적으로 표현
              env:
                - name: DB_HOST
                  value: mysql-service # Service의 name만 입력하면 다른 서비스와 통신할 수 있다. 
    ****            - name: DB_PORT
                  value: "3306" # 숫자값을 문자로 인식하게 만들기 위해 쌍따옴표 붙여야 한다.
                - name: DB_NAME
                  value: kub-practice
                - name: DB_USERNAME
                  value: root
                - name: DB_PASSWORD
                  value: password123
    ```
    

**spring-service.yaml**

```bash
apiVersion: v1
kind: Service

# Service 기본 정보
metadata:
  name: spring-service

# Service 세부 정보
spec:
  type: NodePort # Service의 종류
  selector:
    app: backend-app # 실행되고 있는 파드 중 'app: backend-app'이라는 값을 가진 파드와 서비스를 연결
  ports:
    - protocol: TCP # 서비스에 접속하기 위한 프로토콜
      port: 8080 # 쿠버네티스 내부에서 Service에 접속하기 위한 포트 번호 (Service
      targetPort: 8080 # 매핑하기 위한 파드의 포트 번호
      nodePort: 30000 # 외부에서 사용자들이 접근하게 될 포트 번호
```

1. **매니페스트 파일 실행하기**
    
    ```bash
    $ kubectl apply -f spring-deployment.yaml
    $ kubectl apply -f spring-service.yaml
    ```
    
2. **MySQL과 연결된 백엔드 서버 잘 작동하는 지 확인하기**
    
<img width="334" height="149" alt="image" src="https://github.com/user-attachments/assets/bbb6f97a-b3a5-4792-8fc4-afd0686f7c8a" />
    

### ✅ 그림으로 이해하기

<img width="2048" height="939" alt="image" src="https://github.com/user-attachments/assets/1e014f90-b6c0-4aeb-a1de-81976d6d56c6" />
