# [ì˜ˆì œ] ë””í”Œë¡œì´ë¨¼íŠ¸(Deployment)ë¥¼ í™œìš©í•´ MySQL ì‹¤í–‰ì‹œí‚¤ê¸°

### âœ…Â ë””í”Œë¡œì´ë¨¼íŠ¸(Deployment) í™œìš©í•´ MySQL ì‹¤í–‰ì‹œí‚¤ê¸°

1. **ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ ìƒì„±í•˜ê¸°**
    
    **mysql-deployment.yaml**
    
    ```bash
    apiVersion: apps/v1
    kind: Deployment
    
    # Deployment ê¸°ë³¸ ì •ë³´
    metadata:
      name: mysql-deployment # Deployment ì´ë¦„
    
    # Deployment ì„¸ë¶€ ì •ë³´
    spec:
      replicas: 1 # ìƒì„±í•  íŒŒë“œì˜ ë³µì œë³¸ ê°œìˆ˜
      selector:
        matchLabels:
          app: mysql-db # ì•„ë˜ì—ì„œ ì •ì˜í•œ Pod ì¤‘ 'app: mysql-db'ì´ë¼ëŠ” ê°’ì„ ê°€ì§„ íŒŒë“œë¥¼ ì„ íƒ
    
      # ë°°í¬í•  Pod ì •ì˜
      template:
        metadata:
          labels: # ë ˆì´ë¸” (= ì¹´í…Œê³ ë¦¬)
            app: mysql-db
        spec:
          containers:
            - name: mysql-container # ì»¨í…Œì´ë„ˆ ì´ë¦„
              image: mysql # ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©í•  ì´ë¯¸ì§€
              ports:
                - containerPort: 3306  # ì»¨í…Œì´ë„ˆì—ì„œ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸ë¥¼ ëª…ì‹œì ìœ¼ë¡œ í‘œí˜„
              env:
                - name: MYSQL_ROOT_PASSWORD
                  **~~value: password123**~~
                  valueFrom:
                    secretKeyRef:
                      name: mysql-secret
                      key: mysql-root-password
                - name: MYSQL_DATABASE
                  **~~value: kub-practice~~**
                  valueFrom:
                    configMapKeyRef: 
                      name: mysql-config
                      key: mysql-database
    ```
    
    **mysql-secret.yaml**
    
    ```bash
    apiVersion: v1
    kind: Secret
    
    # Secret ê¸°ë³¸ ì •ë³´
    metadata:
      name: mysql-secret # Secret ì´ë¦„
    
    # Key, Value í˜•ì‹ìœ¼ë¡œ ê°’ ì €ì¥
    stringData:
      mysql-root-password: password123
    ```
    
    **mysql-config.yaml**
    
    ```bash
    apiVersion: v1
    kind: ConfigMap
    
    # ConfigMap ê¸°ë³¸ ì •ë³´
    metadata:
      name: mysql-config # ConfigMap ì´ë¦„
    
    # Key, Value í˜•ì‹ìœ¼ë¡œ ì„¤ì •ê°’ ì €ì¥
    data:
      mysql-database: kub-practice
    ```
    
    **mysql-service.yaml**
    
    ```bash
    apiVersion: v1
    kind: Service
    
    # Service ê¸°ë³¸ ì •ë³´
    metadata:
      name: mysql-service # Service ì´ë¦„
      
    # Service ì„¸ë¶€ ì •ë³´
    spec:
      type: NodePort # Serviceì˜ ì¢…ë¥˜
      selector:
        app: mysql-db # ì‹¤í–‰ë˜ê³  ìˆëŠ” íŒŒë“œ ì¤‘ 'app: mysql-db'ì´ë¼ëŠ” ê°’ì„ ê°€ì§„ íŒŒë“œì™€ ì„œë¹„ìŠ¤ë¥¼ ì—°ê²°
      ports:
        - protocol: TCP # ì„œë¹„ìŠ¤ì— ì ‘ì†í•˜ê¸° ìœ„í•œ í”„ë¡œí† ì½œ
          port: 3306 # ì¿ ë²„ë„¤í‹°ìŠ¤ ë‚´ë¶€ì—ì„œ Serviceì— ì ‘ì†í•˜ê¸° ìœ„í•œ í¬íŠ¸ ë²ˆí˜¸
          targetPort: 3306 # ë§¤í•‘í•˜ê¸° ìœ„í•œ íŒŒë“œì˜ í¬íŠ¸ ë²ˆí˜¸
          nodePort: 30002 # ì™¸ë¶€ì—ì„œ ì‚¬ìš©ìë“¤ì´ ì ‘ê·¼í•˜ê²Œ ë  í¬íŠ¸ ë²ˆí˜¸
    ```
    
2. **ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ê¸°ë°˜ìœ¼ë¡œ ì˜¤ë¸Œì íŠ¸ ìƒì„±í•˜ê¸°**
    
    ```bash
    $ kubectl apply -f mysql-secret.yaml
    $ kubectl apply -f mysql-config.yaml
    $ kubectl apply -f mysql-deployment.yaml
    $ kubectl apply -f mysql-service.yaml
    ```
    
3. **DB ì ‘ì†í•´ë³´ê¸°**
    
<img width="2048" height="692" alt="image" src="https://github.com/user-attachments/assets/60fccff2-8724-4910-a8a0-7b7ef4536382" />
    
<img width="1524" height="562" alt="image" src="https://github.com/user-attachments/assets/02552043-78fd-4134-8dee-7486940f4149" />
    
4. **ìƒˆë¡œìš´ ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±í•˜ê¸°**
    
<img width="956" height="522" alt="image" src="https://github.com/user-attachments/assets/f2378c33-60a5-48d6-9de1-9945191f853d" />
    

### âœ…Â MySQL ì¬ì‹œì‘ì‹œí‚¤ê¸°

<aside>
ğŸ§‘ğŸ»â€ğŸ«

ì—¬ê¸°ì„œ MySQLê°€ ì´ìœ  ëª¨ë¥¼ ì¥ì• ë¡œ ì„œë¹„ìŠ¤ê°€ ì¤‘ë‹¨ëë‹¤ê³  ê°€ì •í•˜ì. ê·¸ë˜ì„œ ë””í”Œë¡œì´ë¨¼íŠ¸ë¥¼ ë‹¤ì‹œ ì‹œì‘í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ë¼ê³  í•´ë³´ì. 

</aside>

1. **ë””í”Œë¡œì´ë¨¼íŠ¸ ì¬ì‹œì‘í•˜ê¸°**
    
    ```
    $ kubectl rollout restart deployment mysql-deployment
    ```
    
2. **ë°ì´í„°ë² ì´ìŠ¤ ë‹¤ì‹œ í™•ì¸í•´ë³´ê¸°**
    
<img width="772" height="536" alt="image" src="https://github.com/user-attachments/assets/5750b7d5-f0cd-4e69-bb30-d818eb99a95c" />
    

> ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í™•ì¸í•´ë³´ë©´ ì´ì „ì— ë§Œë“¤ì—ˆë˜ `new-db`ë¼ëŠ” ë°ì´í„°ë² ì´ìŠ¤ê°€ ì—†ì–´ì¡Œë‹¤. ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” ë°ì´í„°ê°€ ì—†ì–´ì ¸ì„œëŠ” ì•ˆ ëœë‹¤. ë°ì´í„°ê°€ ë³´ì¡´ë˜ë„ë¡ ë³¼ë¥¨(Volume)ì„ ì„¤ì •í•´ë³´ì.
>
