# ë³¼ë¥¨(Volume)ì„ í™œìš©í•´ MySQL ì‹¤í–‰ì‹œí‚¤ê¸°

### âœ…Â ë³¼ë¥¨(Volume)ì„ í™œìš©í•´ MySQL ì‹¤í–‰ì‹œí‚¤ê¸°

<aside>
ğŸ§‘ğŸ»â€ğŸ«

ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í™•ì¸í•´ë³´ë©´ ì´ì „ì— ë§Œë“¤ì—ˆë˜ `new-db`ë¼ëŠ” ë°ì´í„°ë² ì´ìŠ¤ê°€ ì—†ì–´ì¡Œë‹¤. ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” ë°ì´í„°ê°€ ì—†ì–´ì ¸ì„œëŠ” ì•ˆ ëœë‹¤. ë°ì´í„°ê°€ ë³´ì¡´ë˜ë„ë¡ ë³¼ë¥¨(Volume)ì„ ì„¤ì •í•´ë³´ì. 

</aside>

1. **í¼ì‹œìŠ¤í„´íŠ¸ ë³¼ë¥¨(PV), í¼ì‹œìŠ¤í„´íŠ¸ ë³¼ë¥¨ í´ë ˆì„(PVC) ì •ì˜í•˜ê¸°**
    
    **mysql-pv.yaml**
    
    ```bash
    apiVersion: v1
    kind: PersistentVolume
    
    # PersistentVolume ê¸°ë³¸ ì •ë³´
    metadata:
      name: mysql-pv # PersistentVolume ì´ë¦„
    
    # PersistentVolume ì„¸ë¶€ ì •ë³´
    spec:
      storageClassName: my-storage # PVì™€ PVCì˜ storageClassNameì´ ê°™ë‹¤ë©´ ë³¼ë¥¨ì´ ì—°ê²°ëœë‹¤.
      capacity: 
        storage: 1Gi # ë³¼ë¥¨ì´ ì‚¬ìš©í•  ìš©ëŸ‰ì„ ì„¤ì •
      accessModes:
        - ReadWriteOnce # ì•„ë˜ hostPath íƒ€ì… í™œìš© ì‹œ ì´ ì˜µì…˜ë§Œ ì‚¬ìš© ê°€ëŠ¥
      hostPath: # hostPath íƒ€ì…ì„ í™œìš© (hostPath : ì¿ ë²„ë„¤í‹°ìŠ¤ ë‚´ë¶€ ê³µê°„ì„ í™œìš©)
        path: "/mnt/data" # ì¿ ë²„ë„¤í‹°ìŠ¤ ë‚´ë¶€ì˜ ê³µê°„ì—ì„œ /mnt/dataì˜ ê²½ë¡œë¥¼ ë³¼ë¥¨ìœ¼ë¡œ ì‚¬ìš© 
    ```
    
    **mysql-pvc.yaml**
    
    ```bash
    apiVersion: v1
    kind: PersistentVolumeClaim
    
    # PersistentVolumeClaim ê¸°ë³¸ ì •ë³´
    metadata:
      name: mysql-pvc # PersistentVolumeClaim ì´ë¦„
      
    # PersistentVolumeClaim ì„¸ë¶€ ì •ë³´
    spec:
      storageClassName: my-storage # PVì™€ PVCì˜ storageClassNameì´ ê°™ë‹¤ë©´ ë³¼ë¥¨ì´ ì—°ê²°ëœë‹¤.
      accessModes:
        - ReadWriteOnce # ë³¼ë¥¨ì— ì ‘ê·¼í•  ë•Œì˜ ê¶Œí•œ
      resources: # PVCê°€ PVì— ìš”ì²­í•˜ëŠ” ë¦¬ì†ŒìŠ¤ì˜ ì–‘ì„ ì •ì˜
        requests: # í•„ìš”í•œ ìµœì†Œ ë¦¬ì†ŒìŠ¤
          storage: 1Gi # PVCê°€ PVì— ìš”ì²­í•˜ëŠ” ìŠ¤í† ë¦¬ì§€ ì–‘ (PVê°€ ìµœì†Œ 1Gi ì´ìƒì€ ë˜ì–´ì•¼ í•œë‹¤.)
    ```
    

1. **ê¸°ì¡´ ë””í”Œë¡œì´ë¨¼íŠ¸(Deployment) ìˆ˜ì •í•˜ê¸°**
    
    **mysql-deploymentyaml.yaml**
    
    ```bash
    apiVersion: apps/v1
    kind: Deployment
    
    # Deployment ê¸°ë³¸ ì •ë³´
    metadata:
      name: mysql-deployment # Deployment ì´ë¦„
    
    # Deployment ì„¸ë¶€ ì •ë³´
    spec:
      replicas: 1 # ìƒì„±í•  íŒŒë“œì˜ ë³µì œë³¸ ê°œìˆ˜
      selector:
        matchLabels:
          app: mysql-db # ì•„ë˜ì—ì„œ ì •ì˜í•œ Pod ì¤‘ 'app: backend-app'ì´ë¼ëŠ” ê°’ì„ ê°€ì§„ íŒŒë“œë¥¼ ì„ íƒ
    
      # ë°°í¬í•  Pod ì •ì˜
      template:
        metadata:
          labels: # ë ˆì´ë¸” (= ì¹´í…Œê³ ë¦¬)
            app: mysql-db
        spec:
          containers:
            - name: mysql-container # ì»¨í…Œì´ë„ˆ ì´ë¦„
              image: mysql # ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©í•  ì´ë¯¸ì§€
              ports:
                - containerPort: 3306  # ì»¨í…Œì´ë„ˆì—ì„œ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸ë¥¼ ëª…ì‹œì ìœ¼ë¡œ í‘œí˜„
              env:
                - name: MYSQL_ROOT_PASSWORD
                  valueFrom:
                    secretKeyRef:
                      name: mysql-secret
                      key: mysql-root-password
                - name: MYSQL_DATABASE
                  valueFrom:
                    configMapKeyRef:
                      name: mysql-config
                      key: mysql-database
              # ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ ì–´ë–¤ ê²½ë¡œë¥¼ ë³¼ë¥¨ìœ¼ë¡œ ì‚¬ìš©í•  ì§€ ì§€ì •
              **volumeMounts:
    	          - name: mysql-persistent-storage** # ë°‘ì—ì„œ ì„¤ì •í•  volumes.nameê³¼ ê°’ì´ ê°™ì•„ì•¼ í•¨
    	            **mountPath: /var/lib/mysql** # mysql ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— ìˆëŠ” ê²½ë¡œ
          # íŒŒë“œê°€ ì‚¬ìš©í•  ë³¼ë¥¨ì„ ì§€ì •
          **volumes:
    	      - name: mysql-persistent-storage** # ìœ„ì—ì„œ ì„¤ì •í•  volumeMounts.nameê³¼ ì¼ì¹˜í•´ì•¼ í•¨
    	        **persistentVolumeClaim:
    	          claimName: mysql-pvc** # ì—°ê²°ì‹œí‚¬ PVCì˜ nameê³¼ ë™ì¼í•´ì•¼ í•¨
    ```
    
2. **ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ ë°˜ì˜í•˜ê¸°**
    
    ```bash
    $ kubectl apply -f mysql-pv.yaml
    $ kubectl apply -f mysql-pvc.yaml
    $ kubectl apply -f mysql-deployment.yaml
    ```
    
3. **ìƒˆë¡œìš´ ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±í•˜ê¸°**
    
  <img width="956" height="522" alt="image" src="https://github.com/user-attachments/assets/ed9750d6-19f0-4f1f-b5e9-ffd28d1f2f76" />
    
4. **ë””í”Œë¡œì´ë¨¼íŠ¸ ì¬ì‹œì‘í•˜ê¸°**
    
    ```
    $ kubectl rollout restart deployment mysql-deployment
    ```
    
5. **ë°ì´í„°ë² ì´ìŠ¤ ë‹¤ì‹œ í™•ì¸í•´ë³´ê¸°**
    
    ë””í”Œë¡œì´ë¨¼íŠ¸ë¥¼ ì¬ì‹œì‘í•˜ê¸° ì „ì— ìƒì„±í–ˆë˜ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì‚­ì œë˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ì˜ ë‚¨ì•„ìˆëŠ” ê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤. 
    
  <img width="956" height="522" alt="image" src="https://github.com/user-attachments/assets/e04b2ee5-0f37-4d4b-a0dd-bda27d0441b5" />
